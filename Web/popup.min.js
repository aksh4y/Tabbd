function setOnline(){$("#status").css("color","green"),$("#connectivity").css("color","green"),$("#connectivity").text("CONNECTED"),$("#sync").css("color","green"),$("#sync").text("Syncing..."),$(".glyphicon-plus").removeClass("disabled"),$(".glyphicon-plus").prop("onclick",null).off("click"),$(".glyphicon-plus").click(showModal)}function setOffline(){$("#status").css("color","red"),$("#connectivity").text("DISCONNECTED"),$("#connectivity").css("color","red"),$("#sync").css("color","red"),$(".glyphicon-plus").prop("onclick",null).off("click"),$(".glyphicon-plus").addClass("disabled"),$(".col-xs-1").prop("onclick",null).off("click"),$(".glyphicon-remove").addClass("disabled"),$(".col-xs-1").addClass("disabled"),$(".disabled").click(function(){$("#offlineAlert").show()})}function signOut(){chrome.cookies.remove({url:"https://akshaysadarangani.com/Tabbd",name:"Token"},function(){location.href="login.html"})}function showModal(){$("#myModal").modal("show"),$("#myModal").on("shown.bs.modal",function(){$("#url").focus()})}function addWebsite(){var e=$("#url")[0].value,t=firebase.database().ref("websites").push().key;firebase.database().ref("websites/"+t).set({creator:userID,url:e}),$("#myModal").modal("hide"),$("#url")[0].value=""}function getWebsites(){$("#openTabs").hide(),$("#list").empty();var e=[];myRef.off("child_added"),myRef.on("child_added",function(t){buildWebsites(t.val().url,t.key),e.push(t.val().url),$("#openTabs").show()}),myRef.once("value").then(function(t){chrome.storage.sync.set({websites:e},function(){var e=new Date,t=e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate(),s=e.getHours()+":"+e.getMinutes()+":"+e.getSeconds(),n=t+" "+s;chrome.storage.sync.set({lastSync:n},function(){$("#sync").text("Last sync: "+n),$("#loader").hide()})})}),myRef.on("child_changed",function(e){var t="#"+e.key;$(t).text(e.val().url);var s=document.createElement("a");s.textContent=e.val().url,s.setAttribute("href",e.val().url),s.setAttribute("target","_blank"),$(t).html(s)}),myRef.on("child_removed",function(e){var t="#"+e.key;$(t).remove()})}function getCachedWebsites(){var e=!1;chrome.storage.sync.get("websites",function(t){$("#list").empty();for(var s=0;s<t.websites.length;s++)buildWebsites(t.websites[s],"offline"),e=!0;e&&($("#openTabs").show(),$("#openTabs").click(openAllTabs))}),chrome.storage.sync.get("lastSync",function(e){$("#sync").text("Last sync: "+e.lastSync),$("#loader").hide()})}function openAllTabs(){var e=$("#list li");e.each(function(e,t){var s=$("a",$(t)).attr("href");chrome.tabs.create({url:s})})}function buildWebsites(e,t){var s=$("#list")[0],n=document.createElement("li");n.classList.add("list-group-item");var a=document.createElement("a");a.textContent=e,a.setAttribute("href",e),a.setAttribute("target","_blank");var i=document.createElement("div");i.classList.add("row");var o=document.createElement("div");o.classList.add("col-xs-11"),o.appendChild(a);var l=document.createElement("div");l.classList.add("col-xs-1");var c=document.createElement("span");c.classList.add("glyphicon"),c.classList.add("glyphicon-remove"),"offline"===t?(c.classList.add("disabled"),c.onclick=function(){$("#offlineAlert").show()}):(n.setAttribute("id",t),l.setAttribute("id",t+"_del"),l.onclick=function(){var e=$(this)[0].id;e=e.replace("_del",""),firebase.database().ref("websites").child(e).remove()}),l.appendChild(c),i.appendChild(o),i.appendChild(l),n.appendChild(i),s.appendChild(n)}var userID,myRef;window.onload=function(){var e={apiKey:"AIzaSyC7EMx2g634xqV7I1QfiA96SBz7jEUyNy0",authDomain:"tabbd-6980e.firebaseapp.com",databaseURL:"https://tabbd-6980e.firebaseio.com",projectId:"tabbd-6980e",storageBucket:"tabbd-6980e.appspot.com",messagingSenderId:"638927166371"};firebase.initializeApp(e),chrome.cookies.get({url:"https://akshaysadarangani.com/Tabbd",name:"Token"},function(e){e?($("#loader").show(),navigator.onLine?(setOnline(),userID=e.value,myRef=firebase.database().ref("websites").orderByChild("creator").equalTo(userID),getWebsites()):(setOffline(),getCachedWebsites())):location.href="login.html"}),$("#signOut").click(signOut),$("#openTabs").click(openAllTabs),$("#add").click(addWebsite),$("#close").click(function(){$(".alert").hide()})},window.addEventListener("online",function(e){$("#loader").show(),getWebsites(),setOnline()},!1),window.addEventListener("offline",function(e){setOffline()},!1);